version: "3.9"
services:
  server:
    build:
      context: .
    ports:
      # If changing the local port (left hand side), no other changes required.
      # If changing the remote port (right hand side),
      #   change the port in the args in the build section,
      #   as well as the port in the command section to match
      - "42111:42111"
    working_dir: /app
    volumes:
      - khoj_config:/root/.khoj/
      - khoj_models:/root/.cache/torch/sentence_transformers
    # Use 0.0.0.0 to explicitly set the host ip for the service on the container. https://pythonspeed.com/articles/docker-connection-refused/
    env_file: .env
    environment:
      - ENV_VERSION=dev
    command: --host="0.0.0.0" --port=42111 -vv --anonymous-mode
    networks: 
      - khoj

networks:
  khoj:
 
volumes:
  khoj_config:
  khoj_models:
